/*! NavToSelect - v0.2.1 - 2012-11-28
* https://github.com/KaptinLin/navToSelect
* Copyright (c) 2012 KaptinLin; Licensed GPL */
(function(e,t,n){"use strict";var r="navToSelect",i=t.navToSelect=function(e,n){this.nav=e,this.$nav=t(e),this._isBuilded=!1,this.settings=t.extend({},i.defaults,n),this.init()};i.defaults={maxLevel:4,prependTo:null,activeClass:"active",linkSelector:"a:first",className:"nav2select",indentString:"&ndash;",indentSpace:!0,defaultText:"Navigate to...",useOptgroup:!1,changeEvent:function(){t(this).data("linkable")!==!1&&i.goTo(this.value)}},i.prototype.init=function(){var e=this.getItems();this.build(e),this.$select.on("change",this.settings.changeEvent)},i.prototype.build=function(e){this.$select=t("<select />",{"class":this.settings.className}).html(this.generateOptionsString(e,1)),this.settings.prependTo===null?this.$nav.after(this.$select):this.$select.prependTo(this.settings.prependTo),this._isBuilded=!0},i.prototype.generateOptionString=function(e,t){var n=(new Array(t)).join(this.settings.indentString);return this.settings.indentSpace&&(n+="&nbsp;"),'<option value="'+e.value+'"'+(e.linkable===!1?' data-linkable="false"':"")+(e.actived===!0?' selected="selected"':"")+">"+n+e.label+"</option>"},i.prototype.generateOptionsString=function(e,n){if(n>this.settings.maxLevel)return"";var r="",i=this;return t.each(e,function(e,t){t.linkable===!1&&typeof t.items!="undefined"&&n===1&&i.settings.useOptgroup&&(r+='<optgroup label="'+t.label+'">',r+=i.generateOptionsString(t.items,n+1),r+="</optgroup>"),typeof t.items!="undefined"?(r+=i.generateOptionString(t,n),r+=i.generateOptionsString(t.items,n+1)):r+=i.generateOptionString(t,n)}),r},i.prototype.getItems=function(){function r(e,i){var s=[];return e.children("li").each(function(){var e=t(this),o={value:n.getItemValue(e),label:n.getItemLabel(e),linkable:n.isLinkable(e),actived:n.isActived(e)};e.children("ul, ol").length&&(o.items=[],e.children("ul, ol").each(function(){o.items=o.items.concat(r(t(this),i+1))})),s.push(o)}),s}var e=[];this.settings.defaultText&&(e=e.concat({value:"#",label:this.settings.defaultText,linkable:!1}));var n=this;return e=e.concat(r(this.$nav,1)),e},i.prototype.getItemValue=function(e){return e.find(this.settings.linkSelector).attr("href")},i.prototype.isLinkable=function(e){return this.getItemValue(e)!=="#"},i.prototype.isActived=function(e){return e.is("."+this.settings.activeClass)},i.prototype.getItemLabel=function(e,t){return e.find(this.settings.linkSelector).text()},i.prototype.isBuilded=function(){return this._isBuilded},i.goTo=function(t){e.location.href=t},t.fn.navToSelect=function(e){return this.each(function(){t.data(this,r)||t.data(this,r,new i(this,e))})}})(document,jQuery);